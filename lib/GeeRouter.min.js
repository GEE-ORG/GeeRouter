!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.GeeRouter=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var h=e[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}return function(e,i,h){return i&&t(e.prototype,i),h&&t(e,h),e}}();return function(){function h(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(this,h),this._hash="",this.from={path:"",fullPath:location.href},this.to={path:"",fullPath:location.href},this.historyMod="pushState"in window.history&&a,this.history=[],this.historyAnchor=-1,this.beforeEachFuncs=[],this.afterEachFuncs=[],this.origin=location.protocol+"//"+location.host+location.pathname,this.routes=i,this.defaultPath="/",this.page404=function(){},this.path2Ele={},this.curActive=null,this.isControlling=!1,this.routes.forEach(function(e){e.default&&(t.defaultPath=e.path),"*"===e.path&&(t.page404=e.handler)})}return i(h,[{key:"start",value:function(){var t=this;this.historyMod?window.addEventListener("popstate",function(e){var i=e.state&&e.state.path;i&&(t.pathName=i)}):window.addEventListener("hashchange",function(){t.pathName=location.hash.replace("#!","")}),this._firstPage()}},{key:"parse",value:function(t){var e=this;if("string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof NodeList||t instanceof HTMLCollection||t instanceof Node)return Array.from(t,function(t){if("A"===t.tagName){var i=t.getAttribute("href"),h=i.split("?")[0];e.historyMod?t.addEventListener("click",function(t){t.preventDefault(),e._pushState({path:i},i,i)}):t.setAttribute("href","#!"+i),e.path2Ele[h]?(e.path2Ele[h]=[e.path2Ele[h]],e.path2Ele[h].push(t)):e.path2Ele[h]=t}}),this}},{key:"_firstPage",value:function(){this.historyMod||(""!==location.hash?this.pathName=location.hash.replace("#!",""):location.hash="!"+this.defaultPath)}},{key:"_pushState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";window.history.pushState(t,e,i),this.pathName=i}},{key:"_pathChange",value:function(e){var i=this;if(this.routes.length){var h=e.from,a=e.to,o=this.beforeEachFuncs.length-1,n=this.routes.length-1,s={from:h,to:a,params:{},query:{}},r=a.fullPath;r.indexOf("?")>=0&&r.split("?")[1].split("&").forEach(function(t){var e=t.split("="),i=e[0],h=e[1];s.query[i]=h});for(var c=0;c<=n;c++){var u=function(t){var e=i.routes[t],n=!1;if(i.pathName===e.path)n=!0;else if(/:\w+/.test(e.path)){var r=e.path.match(/:(\w+)/g),c=e.path.replace(/(:\w+)/g,"([^/?]+)"),u=new RegExp(c).exec(i.pathName);if(u&&u.length){n=!0;for(var l=0;l<r.length;l++){var f=r[l].replace(":","");s.params[f]=u[l+1]}}}if(!n)return"continue";if(i.beforeEachFuncs.length){var p=0,y=function t(){p<o?i.beforeEachFuncs[++p](h,a,t):e.handler(s)};i.beforeEachFuncs[0](h,a,y)}else e.handler(s);if(i.afterEachFuncs.length)for(var v=0;v<i.afterEachFuncs.length;v++)i.afterEachFuncs[v](h,a);return e.redirect&&i._updatePath(e.redirect),{v:void 0}}(c);switch(u){case"continue":continue;default:if("object"===(void 0===u?"undefined":t(u)))return u.v}}if(this.beforeEachFuncs.length){var l=0,f=function t(){l<o?i.beforeEachFuncs[++l](h,a,t,"404"):i.page404(s)};this.beforeEachFuncs[0](h,a,f,"404")}else this.page404(s)}}},{key:"_updatePath",value:function(t){this.historyMod?this._pushState({path:t},t,t):window.location.hash="!"+t}},{key:"beforeEach",value:function(t){return this.beforeEachFuncs.push(t),this}},{key:"afterEach",value:function(t){return this.afterEachFuncs.push(t),this}},{key:"back",value:function(){this.go(-1)}},{key:"forward",value:function(){this.go(1)}},{key:"go",value:function(t){if(this.isControlling=!0,!((t=~~t)<0&&0===this.historyAnchor||t>0&&this.historyAnchor===this.history.length-1)){var e=this.historyAnchor+t;t>0&&(e=e>this.history.length-1?this.history.length-1:e),t<0&&(e=e<0?0:e),this.historyAnchor=e;var i=this.history[e];this._updatePath(i)}}},{key:"push",value:function(t){this._updatePath(t)}},{key:"pathName",get:function(){return this._hash},set:function(t){this.from.path=this.pathName.split("?")[0],this.from.fullPath=this.origin+"#!"+this.pathName,this._hash=t,this.to.path=this.pathName.split("?")[0],this.to.fullPath=this.origin+"#!"+this.pathName,this.isControlling?this.isControlling=!1:(this.history.push(this.pathName),this.historyAnchor=this.history.length-1),this._pathChange({from:this.from,to:this.to}),this.curActive&&(Array.isArray(this.path2Ele[this.curActive])?this.path2Ele[this.curActive].forEach(function(t){t.classList.remove("active")}):this.path2Ele[this.curActive].classList.remove("active")),Array.isArray(this.path2Ele[this.to.path])?this.path2Ele[this.to.path].forEach(function(t){t.classList.add("active")}):this.path2Ele[this.to.path].classList.add("active"),this.curActive=this.to.path}}]),h}()});
