!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.GeeRouter=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},h=function(){function t(t,e){for(var h=0;h<e.length;h++){var i=e[h];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,h,i){return h&&t(e.prototype,h),i&&t(e,i),e}}();return function(){function i(){var t=this,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(this,i),this._hash="",this.from={path:"",fullPath:location.href},this.to={path:"",fullPath:location.href},this.historyMod="pushState"in window.history&&a,this.history=[],this.historyAnchor=-1,this.beforeEachFuncs=[],this.afterEachFuncs=[],this.origin=location.protocol+"//"+location.host+location.pathname,this.routes=h,this.defaultPath="/",this.page404=function(){},this.path2Ele={},this.curActive=null,this.routes.forEach(function(e){e.default&&(t.defaultPath=e.path),"*"===e.path&&(t.page404=e.handler)})}return h(i,[{key:"start",value:function(){var t=this;this.historyMod?window.addEventListener("popstate",function(e){var h=e.state&&e.state.path;h&&(t.pathName=h)}):window.addEventListener("hashchange",function(){t.pathName=location.hash.replace("#!","")}),this.firstPage()}},{key:"parse",value:function(t){var e=this;"string"==typeof t&&(t=document.querySelectorAll(t)),(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Node)&&Array.from(t,function(t){if("A"===t.tagName){var h=t.pathname;e.historyMod?t.addEventListener("click",function(t){t.preventDefault(),e._pushState({path:h},h,h)}):t.setAttribute("href","#!"+h),e.path2Ele[h]?(e.path2Ele[h]=[e.path2Ele[h]],e.path2Ele[h].push(t)):e.path2Ele[h]=t}})}},{key:"firstPage",value:function(){if(this.historyMod)return void(this.defaultPath&&this._pushState({path:this.defaultPath},null,this.defaultPath));""!==location.hash?this.pathName=location.hash.replace("#!",""):location.hash="!"+this.defaultPath}},{key:"_pushState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";window.history.pushState(t,e,h),this.pathName=h}},{key:"pathChange",value:function(e){var h=this;if(this.routes.length){for(var i=e.from,a=e.to,o=this.beforeEachFuncs.length-1,s=this.routes.length-1,n={from:i,to:a,params:{},query:{}},r=0;r<=s;r++){var c=function(t){var e=h.routes[t],s=!1;if(h.pathName===e.path)s=!0;else if(/:\w+/.test(e.path)){var r=e.path.match(/:(\w+)/g),c=e.path.replace(/(:\w+)/g,"([^/]+)"),u=new RegExp(c).exec(h.pathName);if(u&&u.length){s=!0;for(var f=0;f<r.length;f++){var l=r[f].replace(":","");n.params[l]=u[f+1]}console.log(n)}}if(!s)return"continue";if(h.beforeEachFuncs.length){var p=0,y=function t(){p<o?h.beforeEachFuncs[++p](i,a,t):e.handler(n)};h.beforeEachFuncs[0](i,a,y)}else e.handler(n);if(h.afterEachFuncs.length)for(var v=0;v<h.afterEachFuncs.length;v++)h.afterEachFuncs[v]();return{v:void 0}}(r);switch(c){case"continue":continue;default:if("object"===(void 0===c?"undefined":t(c)))return c.v}}if(this.beforeEachFuncs.length){var u=0,f=function t(){u<o?h.beforeEachFuncs[++u](i,a,t,"404"):h.page404(n)};this.beforeEachFuncs[0](i,a,f,"404")}else this.page404(n)}}},{key:"beforeEach",value:function(t){return this.beforeEachFuncs.push(t),t(this.from,this.to,function(){}),this}},{key:"afterEach",value:function(t){return this.afterEachFuncs.push(t),t(this.from,this.to),this}},{key:"back",value:function(){this.history.length<2||(this.pathName=this.history[this.historyAnchor-1])}},{key:"go",value:function(t){t>0&&this.history.length-1-this.historyAnchor>=t&&(this.pathName=this.history[this.historyAnchor-t]),t<0&&this.historyAnchor>=Math.abs(t)&&(this.pathName=this.history[this.historyAnchor+t])}},{key:"pathName",get:function(){return this._hash},set:function(t){this.from.path=this.pathName,this.from.fullPath=this.origin+"#!"+this.pathName,this._hash=t,this.to.path=this.pathName,this.to.fullPath=this.origin+"#!"+this.pathName,this.history.push(this.pathName),this.historyAnchor+=1,this.pathChange({from:this.from,to:this.to}),this.curActive&&(Array.isArray(this.path2Ele[this.curActive])?this.path2Ele[this.curActive].forEach(function(t){t.classList.remove("active")}):this.path2Ele[this.curActive].classList.remove("active")),Array.isArray(this.path2Ele[this.to.path])?this.path2Ele[this.to.path].forEach(function(t){t.classList.add("active")}):this.path2Ele[this.to.path].classList.add("active"),this.curActive=this.to.path}}]),i}()});
